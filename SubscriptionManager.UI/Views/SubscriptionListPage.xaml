<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SubscriptionManager.UI.Views.SubscriptionListPage"
             xmlns:viewmodels="clr-namespace:SubscriptionManager.UI.ViewModels"
             xmlns:toolkit="clr-namespace:CommunityToolkit.Maui.Behaviors;assembly=CommunityToolkit.Maui"
             BackgroundColor="{StaticResource BackgroundColor}"
             Title="Subksyrybcje">

    <!-- Resources -->
    <ContentPage.Resources>
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="StrokeShape" Value="RoundRectangle 16" />
            <Setter Property="Stroke" Value="Transparent" />
            <Setter Property="BackgroundColor" Value="White" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="Margin" Value="16,8" />
            <Setter Property="Shadow">
                <Shadow Brush="#20000000" 
                        Offset="0,4"
                        Radius="8" />
            </Setter>
        </Style>

        <Style x:Key="AvatarContainerStyle" TargetType="Border">
            <Setter Property="StrokeShape" Value="RoundRectangle 50" />
            <Setter Property="BackgroundColor" Value="{StaticResource BackgroundColor}" />
            <Setter Property="Stroke" Value="Transparent" />
            <Setter Property="WidthRequest" Value="70" />
            <Setter Property="HeightRequest" Value="70" />
            <Setter Property="HorizontalOptions" Value="Start" />
        </Style>

        <Style x:Key="TitleStyle" TargetType="Label">
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="FontSize" Value="18" />
            <Setter Property="TextColor" Value="#333333" />
            <Setter Property="Margin" Value="0,0,0,4" />
        </Style>

        <Style x:Key="DateStyle" TargetType="Label">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="TextColor" Value="#666666" />
            <Setter Property="Margin" Value="0,0,0,2" />
        </Style>

        <Style x:Key="PriceStyle" TargetType="Label">
            <Setter Property="FontSize" Value="18" />
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="TextColor" Value="#2D5AF8" />
        </Style>
    </ContentPage.Resources>

    <!-- Toolbar -->
    <!--<ContentPage.ToolbarItems>
        <ToolbarItem Text="Dodaj" Command="{Binding AddSubscriptionCommand}" IconImageSource="plus.png" />
    </ContentPage.ToolbarItems>-->

    <!-- Page Behaviors -->
    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior 
            EventName="Appearing" 
            Command="{Binding AppearingCommand}"/>
    </ContentPage.Behaviors>

    <!-- Main Content -->
    <Grid RowDefinitions="Auto,*" Padding="0,12,0,0">
        <!-- Header (optional) -->
        <Label Text="Twoje aktywne subskrypcje" 
               FontSize="20" 
               FontAttributes="Bold"
               TextColor="#333333"
               Margin="20,0,0,12"
               Grid.Row="0" />

        <!-- Subscription List -->
        <CollectionView ItemsSource="{Binding Subscriptions}"
                        SelectedItem="{Binding SelectedSubscription}"
                        SelectionMode="Single"
                        Grid.Row="1">
            <CollectionView.Behaviors>
                <toolkit:EventToCommandBehavior 
                    EventName="SelectionChanged" 
                    Command="{Binding SelectedSubscriptionChangedCommand}"
                    EventArgsConverter="{StaticResource SelectionChangedEventArgsConverter}" />
            </CollectionView.Behaviors>

            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="0"/>
            </CollectionView.ItemsLayout>

            <CollectionView.EmptyView>
                <StackLayout VerticalOptions="Center" HorizontalOptions="Center">
                    <Image Source="empty_state.png" HeightRequest="150" Opacity="0.6" Margin="0,0,0,20" />
                    <Label Text="Brak aktywnych subskrypcji" 
                           FontSize="18" 
                           TextColor="#666666"
                           HorizontalTextAlignment="Center" />
                    <Label Text="Dodaj swoją pierwszą subskrypcję klikając przycisk 'Dodaj'" 
                           FontSize="14" 
                           TextColor="#999999"
                           HorizontalTextAlignment="Center"
                           Margin="40,8,40,0" />
                </StackLayout>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border Style="{StaticResource CardStyle}">
                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="16">
                            <!-- Avatar -->
                            <Border Style="{StaticResource AvatarContainerStyle}" Grid.Column="0">
                                <Image Source="{Binding AvatarPath, Converter={StaticResource AvatarConverter}}"
                                       WidthRequest="60"
                                       HeightRequest="60"
                                       Aspect="AspectFit" />
                            </Border>

                            <!-- Subscription Details -->
                            <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                                <Label Text="{Binding Name}" Style="{StaticResource TitleStyle}" />

                                <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto" ColumnSpacing="6">
                                    <!-- From Date -->
                                    <Label Text="Od:" 
                                           Grid.Row="0" 
                                           Grid.Column="0"
                                           TextColor="#999999"
                                           FontSize="13" />
                                    <Label Text="{Binding DateFrom, StringFormat='{0:dd MMM yyyy}'}" 
                                           Grid.Row="0" 
                                           Grid.Column="1"
                                           Style="{StaticResource DateStyle}" />

                                    <!-- To Date -->
                                    <Label Text="Do:" 
                                           Grid.Row="1" 
                                           Grid.Column="0"
                                           TextColor="#999999"
                                           FontSize="13" />
                                    <Label Text="{Binding DateTo, StringFormat='{0:dd MMM yyyy}'}" 
                                           Grid.Row="1" 
                                           Grid.Column="1"
                                           Style="{StaticResource DateStyle}" />
                                </Grid>
                            </VerticalStackLayout>

                            <!-- Price -->
                            <VerticalStackLayout Grid.Column="2" VerticalOptions="Center" HorizontalOptions="End">
                                <Label Text="{Binding Price, StringFormat='{0} zł'}" 
                                       Style="{StaticResource PriceStyle}" />

                                <!-- Status Indicator (optional) -->
                                <Border BackgroundColor="#E6F4EA" 
                                        StrokeShape="RoundRectangle 12"
                                        Padding="8,4"
                                        HorizontalOptions="End"
                                        Margin="0,4,0,0">
                                    <Label Text="Aktywna" 
                                           TextColor="#34A853"
                                           FontSize="11"
                                           FontAttributes="Bold" />
                                </Border>
                            </VerticalStackLayout>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Floating Action Button -->
        <Button Text="+"
                FontSize="24"
                FontAttributes="Bold"
                TextColor="White"
                BackgroundColor="#2D5AF8"
                WidthRequest="56"
                HeightRequest="56"
                CornerRadius="28"
                HorizontalOptions="End"
                VerticalOptions="End"
                Margin="0,0,24,24"
                Command="{Binding AddSubscriptionCommand}"
                Grid.Row="1" />
    </Grid>
</ContentPage>