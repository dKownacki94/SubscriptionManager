<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SubscriptionManager.UI.Views.SubscriptionListPage"
             xmlns:viewmodels="clr-namespace:SubscriptionManager.UI.ViewModels"
             xmlns:toolkit="clr-namespace:CommunityToolkit.Maui.Behaviors;assembly=CommunityToolkit.Maui"
             BackgroundColor="{StaticResource BackgroundColor}"
             Title="Subskrypcje">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Dodaj" Command="{Binding AddSubscriptionCommand}" />
    </ContentPage.ToolbarItems>

    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior 
            EventName="Appearing" 
            Command="{Binding AppearingCommand}"/>
    </ContentPage.Behaviors>

    <CollectionView ItemsSource="{Binding Subscriptions}"
                    SelectedItem="{Binding SelectedSubscription}"
                    SelectionMode="Single">

        <CollectionView.Behaviors>
            <toolkit:EventToCommandBehavior 
            EventName="SelectionChanged" 
            Command="{Binding SelectedSubscriptionChangedCommand}"
            EventArgsConverter="{StaticResource SelectionChangedEventArgsConverter}" />
        </CollectionView.Behaviors>

        <CollectionView.ItemTemplate>

            <DataTemplate>

                <Border Stroke="{StaticResource Gray200}"
                        StrokeShape="RoundRectangle 10"
                        BackgroundColor="White"
                        Padding="10"
                        Margin="10,5,10,5">

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="100" />
                        </Grid.ColumnDefinitions>

                        <Border Stroke="{StaticResource Gray200}"
                                BackgroundColor= "{StaticResource BackgroundColor}"
                                StrokeShape="RoundRectangle 40"
                                WidthRequest="70"
                                HeightRequest="70">
                            <Image Source="{Binding AvatarPath, Converter={StaticResource AvatarConverter}}"
                                   WidthRequest="70"
                                   HeightRequest="70"
                                   Aspect="AspectFill"
                                   Grid.Column="0" />
                        </Border>

                        <StackLayout Grid.Column="1" VerticalOptions="Center">
                            <Label Text="{Binding Name}" FontAttributes="Bold" FontSize="Large" />
                            <Label Text="{Binding DateFrom, StringFormat='{0:dd.MM.yyyy}'}" FontSize="Micro" />
                            <Label Text="{Binding DateTo, StringFormat='{0:dd.MM.yyyy}'}" FontSize="Micro" />
                        </StackLayout>

                        <StackLayout Grid.Column="2" VerticalOptions="Center" HorizontalOptions="End">
                            <Label Text="{Binding Price, StringFormat='{0} zÅ‚'}" FontSize="Large" />
                        </StackLayout>
                    </Grid>
                </Border>
            </DataTemplate>

        </CollectionView.ItemTemplate>
    </CollectionView>
</ContentPage>